<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="user">

	<resultMap id="userMap" type="example.entity.User">
	</resultMap>

	<resultMap id="userBorrowMap" type="example.entity.User">
		<collection property="example.entity.Borrow" javaType="list" >
			<!-- 配置主键，是关联Order的唯一标识 -->
			<id property="id" column="userId" />
			<result property="bookName" column="bookName" />
			<result property="startDate" column="startDate" />
			<result property="entDate" column="entDate" />
			<result property="returnDate" column="returnDate" />
		</collection>
	</resultMap>

	<select id="queryUserBorrow" resultMap="userBorrowMap">
		select u.*,b.* FROM book_users as u left join borrow as b  on
		u.id = b.userId
		<where>
			<if test="id != 0">
				and u.id = #{id}
			</if>
			<if test="bookName != null and bookName !=''">
				and b.bookName = #{bookName}
			</if>
		</where>
		order by b.startDate desc
	</select>

	<!-- auto generate default query -->
	<select id="findUser"
		parameterType="java.util.Map"
		resultMap="userMap">
		SELECT 
				TD.id ,
				TD.userName,
				TD.userPassword,
				TD.phone,
				TD.createDate ,
				TD.updateDate
		  FROM book_users  as TD
		<trim prefix="WHERE" prefixOverrides="AND | OR">
			1 = 1
			<if test="id!=null and id !=''">
				and id = #{id}
			</if>
			<if test="userName!=null and userName !=''">
				and userName = #{userName}
			</if>
		</trim>


	</select>

	<select id="selectAllUser" resultType="example.entity.User">
		select * from book_users
	</select>

	<select id="selectAllUserList" resultType="example.entity.User">
		select * from book_users limit #{pageNo} ,#{pageNum}
	</select>

	<select id="count" resultType="int">
		select count(*) as count from book_users
		<where>
			<if test="userName != null">
				userName like "%"#{userName}"%"
			</if>
		</where>
	</select>


	<select id="queryUser" resultType="example.entity.User">
		select * from book_users
		<where>
			 <if test="userName != null">
				userName like "%"#{userName}"%"
			 </if>
		</where>
	</select>

<!--	根据用户名称查询出所有的用户，并且分页-->
	<select id="queryAllUser" resultType="example.entity.User">
		select * from book_users
		<where>
			<if test="userName != null">
				userName like "%"#{userName}"%"
			</if>
		</where>
		limit #{pageNo} ,#{pageNum}
	</select>


	<insert id="addUser">
		INSERT INTO book_users ( userName, userPassword, phone, createDate)
		values (#{userName}, #{userPassword}, #{phone}, #{createDate})
	</insert>

	<select id="findUserByName2" resultType="example.entity.User">
		select * from book_users where userName = #{userName}
	</select>

	<update id="resetPwd">
		update book_users set userPassword = #{pwd} where id = #{userId}
	</update>
	
		<!-- auto generate default count -->



</mapper>
<!--
sqlMap生成描述:

-->